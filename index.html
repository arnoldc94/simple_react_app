<!DOCTYPE html>
<html>
  <head>
    <title>React Test</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src='https://unpkg.com/babel-standalone@6.26.0/babel.js'></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState } = React;

      //Submit button component
      //renders the submit button and calls the onClick function during an onClick event
      const SubmitNameButton = ({ onClick }) => {
        return (
          <button onClick={onClick} style={{borderRadius:'3px'}}>Submit</button>
        );
      };

      // Form component
      const NameInputForm = ({ onSubmit }) => {
        // name state holds the current value of the input field
        const [name, setName] = useState('');

        //handleSubmit called when the form is submitted
        //prevents the default form submission and calls the onSubmit function with the current value of the input field
        const handleSubmit = (e) => {
          e.preventDefault();
          onSubmit(name);
          setName(''); //Clear the input field after submission
        };

        return (
          <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'row', gap: '10px' }}>
              <label>
                Name:
                <input type="text" value={name} onChange={e => setName(e.target.value)} style={{ textAlign: 'center', fontSize: '20px'}}/>
              </label>
              <SubmitNameButton onClick={handleSubmit} />
          </form>
        );
      };

      const App = () => {
        //ages state holds the predicted ages for each name
        const [ages, setAges] = useState({});
        //output state holds the output message
        const [output, setOutput] = useState('');

        //handleFormSubmit function is called when the NameIForm is submitted
        // If the age for the submitted name is already in the ages state, the output message is set to the predicted age
        // If the age for the submitted name is not in the ages state, a get request is made to the agify API
        const handleFormSubmit = (name) => {
          ages[name]
            ? setOutput(`${name} is predicted to be ${ages[name]} years old`) 
            : $.get(`https://api.agify.io?name=${name}`, (data) => {
                setAges({ ...ages, [name]: data.age });
                setOutput(`${name} is predicted to be ${data.age} years old`);
              });
        };

        return (
          <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100vh' }}>
            <h1>Age Predictor</h1>
            <h2>Enter a name to predict the age</h2>
            <NameInputForm onSubmit={handleFormSubmit}/>
            <p>{output}</p>
          </div>
        
        );
      };

      ReactDOM.render(<App />, document.querySelector('#root'));
    </script>
  </body>
</html>
